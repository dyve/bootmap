(function(a){"use strict";var b={options:{lat:{type:"float"},lng:{type:"float"},zoom:{type:"int",value:8},input:{}}},c=new RegExp(/\s+/g),d=function(b){return a.trim(b.replace(c," ")).replace(") ,","),")},e=function(a){return f(d(a))},f=function(b){var c=[],d,e,g,h,i,j;b=a.trim(b);if(b[0]==="("){g=b.length,b=b.substr(1,g-2),b=b.split("),");for(d=0;d<b.length;d++){h=b[d];if(d>0){h=a.trim(h);if(h[0]!=="(")return null;h=h.substr(1)}c[d]=f(h)}}else{b=b.split(",");for(d=0;d<b.length;d++){h=a.trim(b[d]).split(" "),i=parseFloat(h[0]),j=parseFloat(h[1]);if(isNaN(i)||isNaN(j))return null;c[d]=[i,j]}}return c},g=function(b){var c,d,f,g,h=b.indexOf("(");if(h===-1)throw"Invalid WKT, format not recognized";c=a.trim(b.substr(0,h)).toUpperCase();if(!c)throw"Invalid WKT, no type specified";d=a.trim(b.substr(h)),f=d.length;if(d[0]!=="("||d[f-1]!==")")throw"Invalid WKT, path not in brackets";g=e(d.substr(1,f-2));if(g===null)throw"Invalid WKT, cannot parse path "+d;switch(c){case"POINT":if(g.length!==1)throw"Invalid WKT, type POINT should have 1 coordinate";c="Point",g=g[0];break;case"LINESTRING":c="LineString";break;case"POLYGON":c="Polygon";break;default:throw"Invalid WKT, unknown type "+c}return{type:c,coordinates:g}},h=function(a,b){return a.attr("data-"+b)},i=function(b){var c=a(b),d=c.filter(":input").length>0,e=d?c.val():c.html(),f=h(c,"type");return f&&e?{input:b,$input:c,rawContent:e,type:f,geom:k(e,f),editable:d}:null},j=function(c,d){var e,f={};return a.each(b.options,function(a,b){var e=d[a];undefined===e&&(e=h(c,a));switch(b.type){case"int":e=parseInt(e,10),isNaN(e)&&(e=b.value);break;case"float":e=parseFloat(e),isNaN(e)&&(e=b.value)}f[a]=e}),f.overlays=[],e=i(c[0]),e&&f.overlays.push(e),f.input&&a(f.input).each(function(){e=i(this),e&&f.overlays.push(e)}),delete f.type,f},k=function(b,c){var d;switch(c.toLowerCase()){case"wkt":d=g(b);break;case"json":d=a.parseJSON(b);break;default:d=null}return d},l=function(a){var b=[];for(var c=0;c<a.length;c++)b.push(new google.maps.LatLng(a[c][1],a[c][0]));return b},m=function(a){var b=[];for(var c=0;c<a.length;c++)b.push(l(a[c]));return b},n=function(a){return a instanceof google.maps.Marker?"Point":a instanceof google.maps.Polyline?"LineString":a instanceof google.maps.Polygon?"Polygon":null},o=function(a){var b=n(a),c,d=x(a),e,f,g,h=[];for(e=0;e<d.length;e++){c=d[e],h[e]=[];for(f=0;f<c.length;f++)g=c[f],h[e][f]=[g.lng(),g.lat()]}switch(b){case"Point":h=h[0][0];break;case"LineString":h=h[0];break;case"Polygon":break;default:h=[]}return{type:b,coordinates:h}},p=function(a){var b=o(a),c=a.overlayData.type,d;switch(c){case"wkt":d=r(b);break;case"geom":d=s(b);break;default:throw"No output support for type "+c}a.overlayData.$input.filter(":input").val(d)},q=function(b){if(!a.isArray(b[0]))return b[0]+" "+b[1];var c=[];for(var d=0;d<b.length;d++)c[d]=q(b[d]);return"("+c.join(",")+")"},r=function(a){return a.type.toUpperCase()+q(a.coordinates)},s=function(b){var c,d=[];if(a.isArray(b)){for(c=0;c<b.length;c++)d.push(s(b[c]));return"[ "+d.join(", ")+" ]"}return typeof b=="object"?(a.each(b,function(a,b){d.push('"'+a+'": '+s(b))}),"{ "+d.join(", ")+" }"):typeof b=="string"?'"'+b+'"':""+b},t=function(a){var b=function(){p(a)},c,d,e=a.getPaths();for(c=0;c<e.getLength();c++)d=e.getAt(c),google.maps.event.addListener(d,"insert_at",b),google.maps.event.addListener(d,"remove_at",b),google.maps.event.addListener(d,"set_at",b)},u=function(a){var b=function(){p(a)},c=a.getPath;google.maps.event.addListener(c,"insert_at",b),google.maps.event.addListener(c,"remove_at",b),google.maps.event.addListener(c,"set_at",b)},v=function(a){var b,c=null,d={};if(a.type==="wkt-file")c=new google.maps.KmlLayer(a.rawContent);else{b=a.geom,d.editable=a.editable;if(b.type==="GeometryCollection"){if(b.geometries.length!==1)throw"Bootmap can only handle GeometryCollections of length 1";b=b.geometries[0]}switch(b.type){case"Point":d.position=new google.maps.LatLng(b.coordinates[1],b.coordinates[0]),c=new google.maps.Marker(d),d.editable&&(c.setDraggable(!0),google.maps.event.addListener(c,"dragend",function(){p(c)}));break;case"LineString":d.path=l(b.coordinates),c=new google.maps.Polyline(d),u(c);break;case"Polygon":d.paths=m(b.coordinates),c=new google.maps.Polygon(d),t(c);break;default:throw"Bootmap cannot handle geometries of type '"+b.type+"'"}}return c&&(c.overlayData=a),c},w=function(a,b){var c=new google.maps.LatLng(b.lat,b.lng);return new google.maps.Map(a,{center:c,zoom:8,mapTypeId:google.maps.MapTypeId.ROADMAP})},x=function(a){var b,c;if(a.getPaths){c=a.getPaths(),b=[];for(var d=0;d<c.getLength();d++)b.push(c.getAt(d).getArray())}else a.getPath?b=[a.getPath().getArray()]:a.getPosition&&(b=[[a.getPosition()]]);return b},y=function(a){var b=new google.maps.LatLngBounds,c,d=x(a),e,f;if(d)for(e=0;e<d.length;e++){c=d[e];for(f=0;f<c.length;f++)b.extend(c[f])}return b};b.initElem=function(b,c){var d,e,f,g=a(b),h=j(g,c),i=w(b,h);if(h.overlays.length){f=new google.maps.LatLngBounds;for(d=0;d<h.overlays.length;d++)e=v(h.overlays[d]),e.setMap(i),f.union(y(e));i.fitBounds(f)}g.data({map:i,mapData:h})},b.googleMapsLoaded=function(){return typeof google!="undefined"&&typeof google.maps!="undefined"&&typeof google.maps.drawing!="undefined"},b.init=function(){a("[data-map]").bootmap()},a.fn.bootmap=function(c){return c=a.extend({},a.fn.options,c),this.each(function(){b.initElem(this,c)})},a.fn.bootmap.defaults={},window.bootmap=b,a(function(){b.googleMapsLoaded()?b.init():a("body").append('<script src="//maps.googleapis.com/maps/api/js?libraries=drawing&sensor=false&callback=bootmap.init"></script>')})})(jQuery);