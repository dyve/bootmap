(function(a){"use strict";var b={BootMapError:function(a){this.message=a},mapParameters:{lat:{type:"float"},lng:{type:"float"},zoom:{type:"int",value:8},input:{}},overlayTypes:{POLYGON:"POLYGON",POLYLINE:"POLYLINE",MARKER:"MARKER"}},c=function(c){var d,e;if(a.isArray(c)&&c.length===2){d=parseFloat(c[1]),e=parseFloat(c[0]);if(!isNaN(d)&&!isNaN(e))return new google.maps.LatLng(d,e)}throw new b.BootMapError("Invalid coordinate. Expected array with 2 floats, got "+x(c))},d=function(a){var b,d=[];for(b=0;b<a.length;b++)d.push(c(a[b]));return d},e=function(a){var b,c=[];for(b=0;b<a.length;b++)c.push(d(a[b]));return c},f=function(b,d){var e=a.extend({},d);return e.position=c(b),new google.maps.Marker(e)},g=function(b,c){var e=a.extend({},c);return e.path=d(b),new google.maps.Polyline(e)},h=function(b,c){var d=a.extend({},c);return d.paths=e(b),new google.maps.Polygon(d)},i=function(a){var b,c=new google.maps.LatLngBounds;for(b=0;b<a.getLength();b++)c.extend(a.getAt(b));return c},j=function(a){var b,c=a.getPaths(),d=new google.maps.LatLngBounds;for(b=0;b<c.getLength();b++)d.union(i(c.getAt(b)));return d},k=function(c){var d=c.replace(/([\d\.])\s+([\d\.])/g,"$1#$2").replace(/\s/g,"").replace(/\(([\d\.])/g,"(($1").replace(/([\d\.])\)/g,"$1))").replace(/([\d\.])\,([\d\.])/g,"$1),($2").replace(/\#/g,",").replace(/\)/g,"]").replace(/\(/g,"[");try{d=a.parseJSON(d)}catch(e){throw new b.BootMapError("Cannot parse WKT path to coordinates array")}return d},l=function(c){var d,e,f,g,h=c.indexOf("(");if(h===-1)throw new b.BootMapError("Invalid WKT, format not recognized");d=a.trim(c.substr(0,h)).toUpperCase();if(!d)throw new b.BootMapError("Invalid WKT, no type specified");e=c.substr(h),g=k(e);switch(d){case"POINT":if(g.length!==1)throw"Invalid WKT, type POINT should have 1 coordinate";d="Point",g=g[0];break;case"MULTIPOINT":d="MultiPoint";break;case"LINESTRING":d="LineString";break;case"MULTILINESTRING":d="MultiLineString";break;case"POLYGON":d="Polygon";break;case"MULTIPOLYGON":d="MultiPolygon";break;default:throw"Invalid WKT, unknown type "+d}return{type:d,coordinates:g}},m=function(b,c){var d;switch(c.toLowerCase()){case"wkt":d=l(b);break;case"json":d=a.parseJSON(b);break;default:d=null}return d},n=function(a,b){return a.attr("data-"+b)},o=function(b){var c=a(b),d=c.filter(":input").length>0,e=d?c.val():c.html(),f=n(c,"type");return f&&e?{elem:b,$elem:c,text:e,type:f,geom:m(e,f),editable:d}:null},p=function(c,d){var e,f={};return a.each(b.mapParameters,function(a,b){var e=d[a];undefined===e&&(e=n(c,a));switch(b.type){case"int":e=parseInt(e,10),isNaN(e)&&(e=b.value);break;case"float":e=parseFloat(e),isNaN(e)&&(e=b.value)}f[a]=e}),f.layers=[],e=o(c[0]),e&&f.layers.push(e),f.input&&a(f.input).each(function(){e=o(this),e&&f.layers.push(e)}),f},q=function(a){return a instanceof google.maps.Marker?b.overlayTypes.MARKER:a instanceof google.maps.Polyline?b.overlayTypes.POLYLINE:a instanceof google.maps.Polygon?b.overlayTypes.POLYGON:null},r=function(a){var b,c;if(a instanceof google.maps.LatLng)return[a.lng(),a.lat()];c=[];for(b=0;b<a.length;b++)c.push(r(a[b]));return c},s=function(a){return r(E(a))},t=function(a){var c=q(a),d=s(a);switch(c){case b.overlayTypes.MARKER:d=d[0][0];break;case b.overlayTypes.POLYLINE:d=d[0];break;case b.overlayTypes.POLYGON:break;default:d=[]}return{type:c,coordinates:d}},u=function(a){var b=t(a),c=a.overlayData.type,d;switch(c){case"wkt":d=w(b);break;case"geom":d=x(b);break;default:throw"No output support for type "+c}a.overlayData.$elem.filter(":input").val(d)},v=function(b){if(!a.isArray(b[0]))return b[0]+" "+b[1];var c=[];for(var d=0;d<b.length;d++)c[d]=v(b[d]);return"("+c.join(",")+")"},w=function(a){return a.type.toUpperCase()+v(a.coordinates)},x=function(b){var c,d=[];if(a.isArray(b)){for(c=0;c<b.length;c++)d.push(x(b[c]));return"[ "+d.join(", ")+" ]"}return typeof b=="object"?(a.each(b,function(a,b){d.push('"'+a+'": '+x(b))}),"{ "+d.join(", ")+" }"):typeof b=="string"?'"'+b+'"':""+b},y=function(a){var b=function(){u(a)},c,d,e=a.getPaths();for(c=0;c<e.getLength();c++)d=e.getAt(c),google.maps.event.addListener(d,"insert_at",b),google.maps.event.addListener(d,"remove_at",b),google.maps.event.addListener(d,"set_at",b)},z=function(a){var b=function(){u(a)},c=a.getPath;google.maps.event.addListener(c,"insert_at",b),google.maps.event.addListener(c,"remove_at",b),google.maps.event.addListener(c,"set_at",b)},A=function(a,b){var c,d;b=b||{};if(a.type==="GeometryCollection"){d=[];for(c=0;c<a.geometries.length;c++)d.push(A(a.geometries[c]))}else{var e=function(d,e){var f=[];for(c=0;c<a.coordinates.length;c++)f.push(A({type:d,coordinates:a.coordinates[c]},b));return f};switch(a.type){case"Point":d=f(a.coordinates,b),b.editable&&(d.setDraggable(!0),google.maps.event.addListener(d,"dragend",function(){u(d)}));break;case"MultiPoint":d=e("Point",a.coordinates);break;case"LineString":d=g(a.coordinates,b),z(d);break;case"MultiLineString":d=e("LineString",a.coordinates);break;case"Polygon":d=h(a.coordinates,b),y(d);break;case"MultiPolygon":d=e("Polygon",a.coordinates);break;default:throw"Bootmap cannot handle geometries of type '"+a.type+"'"}}return d},B=function(b){var c,d,e,f=[];if(!a.isArray(b))f.push(b);else for(c=0;c<b.length;c++){e=B(b[c]);for(d=0;d<e.length;d++)f.push(e[d])}return f},C=function(b){var c,d=null,e={};b.type==="wkt-file"?d=new google.maps.KmlLayer(b.text):d=A(b.geom,e),d=B(d),a.isArray(d)||(d=[d]);for(c=0;c<d.length;c++)d[c].overlayData=b;return d},D=function(a,b){var c=new google.maps.LatLng(b.lat,b.lng);return new google.maps.Map(a,{center:c,zoom:8,mapTypeId:google.maps.MapTypeId.ROADMAP})},E=function(a){var b,c;if(a.getPaths){c=a.getPaths(),b=[];for(var d=0;d<c.getLength();d++)b.push(c.getAt(d).getArray())}else a.getPath?b=[a.getPath().getArray()]:a.getPosition&&(b=[[a.getPosition()]]);return b},F=function(a){var b=new google.maps.LatLngBounds,c,d=E(a),e,f;if(d)for(e=0;e<d.length;e++){c=d[e];for(f=0;f<c.length;f++)b.extend(c[f])}return b},G=function(a){var b,c,d,e=[];for(b=0;b<a.length;b++){d=C(a[b]);for(c=0;c<d.length;c++)e.push(d[c])}return e};b.initElem=function(b,c){var d,e,f,g,h=a(b),i=p(h,c),j=D(b,i);if(i.layers.length){g=new google.maps.LatLngBounds,f=G(i.layers);for(d=0;d<f.length;d++)e=f[d],e.setMap(j),g.union(F(e));j.fitBounds(g)}h.data({map:j,mapData:i})},b.googleMapsLoaded=function(){return typeof google!="undefined"&&typeof google.maps!="undefined"&&typeof google.maps.drawing!="undefined"},b.init=function(){a("[data-map]").bootmap()},a.fn.bootmap=function(c){return c=a.extend({},a.fn.options,c),this.each(function(){b.initElem(this,c)})},a.fn.bootmap.defaults={},window.bootmap=b,a(function(){b.googleMapsLoaded()?b.init():a("body").append('<script src="//maps.googleapis.com/maps/api/js?libraries=drawing&sensor=false&callback=bootmap.init"></script>')})})(jQuery);